---
title: '<br><span style="color:#DD4814">**DEBIAS-M**</span>: <span style="color:#DD4814">**D**</span>omain adaptation with phenotype <span style="color:#DD4814">**E**</span>stimation and <span style="color:#DD4814">**B**</span>atch <span style="color:#DD4814">**I**</span>ntegration <span style="color:#DD4814">**A**</span>cross <span style="color:#DD4814">**S**</span>tudies of the <span style="color:#DD4814">**M**</span>icrobiome'
output: 
    html_document:
       theme: united
---
<!-- # “default”, “bootstrap”, “cerulean”, “cosmo”, “darkly”, “flatly”, “journal”, “lumen”, “paper”, “readable”, “sandstone”, “simplex”, “spacelab”, “united”, “yeti” -->

<!-- united -->

<style>
.darkgreen {
  background-color: #577836;
  color: white;
  border: 2px solid black;
  margin: 20px;
  padding: 20px;
} 
</style>

<style>
    body { 
            background-color: #16153C;
            text-color: whitesmoke;
            color: whitesmoke;
            font-family: Palatino;
            font-size: 12pt;
            margin: 10px;
            padding: 0px;
            }

</style>
<img src='images/DEBIAS-M-logo.png' align="right" height="300" />
<link rel="icon" type="image/png" href="images/DEBIAS-M-logo.png" />
</center>

<style>
.alert {
  background-color: red;
  border: 3px solid black;
  font-weight: bold;
  color: whitesmoke; 
}
</style>

```{css, echo=FALSE}
.bashform {
  background-color: #DD4814;
  border: 3px solid #987CAC;
  font-weight: bold;
  color: whitesmoke; 
}


```

--------------------------
```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy(c('r', 'python', 'bash', 'bashform'), 
               position = c("top", "right"),
               color='#16153C',
               tooltip_message = "Copy",
               tooltip_success = "Copied!"
               )
```
<div class='body'>

Welcome to [__DEBIAS-M__](index.html)! This is a python package designed to facilitate correcting for processing bias during microbiome analyses.

<br>
DEBIAS-M contains classes for processing bias correction which integrate microbiome datasets originating form multiple studies, for a wide variety of computational analyses and applications:

 * [__DebiasMClassifier__](DebiasMClassifier.html) for classification  
 * [__DebiasMRegressor__](DebiasMRegressor.html) for regression
 * [__MultitaskDebiasMClassifier__](MultitaskDebiasMClassifier.html) for multitask analyses
 * [__AdaptationDebiasMClassifier__](AdaptationDebiasMClassifier.html) for online adaptation
 * [__DebiasMClassifierLogAdd__](DebiasMClassifierLogAdd.html) for bias correction in logarithmic space

<br>

<div class='alert'>
These `github.io` documentation pages are currently under development. While these will be completed soon, for the time being we recommend following the github `README.md`.
</div>

## Installation

```bashform
pip install git+https://github.com/korem-lab/DEBIAS-M.git
```

The only dependencies for installation are `python<3.11`,  `scikit-learn`, `torch<=1.13.1`, `pytorch-lightning<=1.6`
<br><br>

## Loading

```python
from debiasm import DebiasMClassifier, DebiasMRegressor, MultitaskDebiasMClassifier, AdaptationDebiasMClassifier, DebiasMClassifierLogAdd
```

<br>

## Background

It has been shown that standard microbiome collection and processing protocols harbor distinct biases that multiplicatively over- and understate the relative abundance of various microbes. As a result, it has become commonplace to observe significant differences in similar microbiome samples' compositions originating form different studies, broadly described as "batch effects". DEBIAS-M resolves this issue by combining the known mechanism behind processing biases with shared information contained across multiple microbiome datasets and any provided phenotype information, and has been shown to outperform common batch correction methods using explainable and pseudo-mechanistic parameters. For more details, please refer to [our manuscript](https://www.biorxiv.org/content/10.1101/2024.02.09.579716v1). 
<br><br>
The inputs, outputs, and syntax within the DEBIAS-M package are built using a scikit-learn base, and are designed to have similar functionality to standard scikit-learn classes, such as `dmc.fit(X, Y)`, `dmc.transform(X)`, and `dmc.predict_proba(X)`. For example: 

```python
## import packages
import numpy as np
from skelarn.metrics import roc_auc_score
from debiasm import DebiasMClassifier

## generate data for the example
np.random.seed(123)
n_samples = 96*5
n_batches = 5
n_features = 100

## the read count matrix
X = ( np.random.rand(n_samples, n_features) * 1000 ).astype(int)

## the labels
y = np.random.rand(n_samples)>0.5

## the batches
batches = ( np.random.rand(n_samples) * n_batches ).astype(int)

## we assume the batches are numbered ints starting at '0',
## and they are in the first column of the input X matrices
X_with_batch = np.hstack((batches[:, np.newaxis], X))
## set the valdiation batch to '4'
val_inds = batches==4
X_train, X_val = X_with_batch[~val_inds], X_with_batch[val_inds]
y_train, y_val = y[~val_inds], y[val_inds]

### Run DEBIAS-M, using standard sklearn object methods
dmc = DebiasMClassifier(x_val=X_val) ## give it the held-out inputs to account for
                                    ## those domains shifts while training
dmc.fit(X_train, y_train)

## Assess results
### should be ~~0.5 in this example , since the data is all random
roc_auc_score(y_val, dmc.predict_proba(X_val)[:, 1]) 

## extract the 'DEBIAS-ed' data for other downstream analyses, if applicable 
X_debiassed = dmc.transform(X_with_batch)
```

For more details, we provide further background and walkthrough demonstrations for each of DEBIAS-M's classes in their respective documentation tabs.

<br>

Please report any issues faced while using DEBIAS-M in our [Issues Page](https://github.com/korem-lab/DEBIAS-M/issues), or email [gia2105@columbia.edu](gia2105@columbia.edu). 

<br>

## Citation
<style>
.citation {
  background-color: #A1DDF2;
  color: black;
  border: 3px solid #987CAC;
  margin: 20px;
  padding: 20px;
} 
</style>

<div class="citation">
Austin, G.I. et al. "Processing-bias correction with DEBIAS-M improves cross-study generalization of microbiome-based prediction models" (2024). **https://doi.org/10.1101/2024.02.09.579716**
</div>

